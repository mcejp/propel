((begin
   (decl-external-fun get-player-input () int)
   (decl-external-fun random-int ((min int) (max int)) int)
   (decl-external-fun brd-count-empty-spots () int)
   (decl-external-fun brd-get-nth-empty-slot-x ((index int)) int)
   (decl-external-fun brd-get-nth-empty-slot-y ((index int)) int)
   (decl-external-fun brd-get-with-rotation ((x int) (y int) (dir int)) int)
   (decl-external-fun
    brd-set-with-rotation
    ((x int) (y int) (dir int) (stone int))
    Void)
   (decl-external-fun is-marked-merged ((pos int)) int)
   (decl-external-fun mark-merged ((pos int) (value int)) Void)
   (decl-external-fun dummy-void () Void)
   (def DIR-LEFT 0)
   (defun
    brd-set
    ((x int) (y int) (value int))
    Void
    (brd-set-with-rotation x y DIR-LEFT value))
   (defun and3 ((a int) (b int) (c int)) int (and (and a b) c))
   (defun
    update-column
    ((x int) (y int) (dir int) (output-pos int))
    int
    (def stone (brd-get-with-rotation x y dir))
    (if stone
      (begin
        (def
         should-merge
         (and3
          (> output-pos 0)
          (= (brd-get-with-rotation (- output-pos 1) y dir) stone)
          (not (is-marked-merged (- output-pos 1)))))
        (if should-merge
          (begin
            (brd-set-with-rotation (- output-pos 1) y dir (* 2 stone))
            (mark-merged (- output-pos 1) 1)
            output-pos)
          (begin
            (brd-set-with-rotation output-pos y dir stone)
            (mark-merged output-pos 0)
            (+ output-pos 1))))
      output-pos))
   (defun
    update-row
    ((y int) (dir int))
    Void
    (def output-pos 0)
    (set! output-pos (update-column 0 y dir output-pos))
    (set! output-pos (update-column 1 y dir output-pos))
    (set! output-pos (update-column 2 y dir output-pos))
    (set! output-pos (update-column 3 y dir output-pos))
    (if (< output-pos 1) (brd-set-with-rotation 0 y dir 0) (dummy-void))
    (if (< output-pos 2) (brd-set-with-rotation 1 y dir 0) (dummy-void))
    (if (< output-pos 3) (brd-set-with-rotation 2 y dir 0) (dummy-void))
    (if (< output-pos 4) (brd-set-with-rotation 3 y dir 0) (dummy-void)))
   (defun
    generate-new-stone
    ()
    Void
    (def new-stone-value (if (< (random-int 0 100) 90) 2 4))
    (def num-empty-spots (brd-count-empty-spots))
    (def nth-spot (random-int 0 num-empty-spots))
    (def x (brd-get-nth-empty-slot-x nth-spot))
    (def y (brd-get-nth-empty-slot-y nth-spot))
    (brd-set x y new-stone-value))
   (defun
    make-turn
    ((dir int))
    Void
    (update-row 0 dir)
    (update-row 1 dir)
    (update-row 2 dir)
    (update-row 3 dir)))
 #f
 ((#<path:tests/2048.rkt> 0 0 0 4835)
  (#f 0 0 0 4835)
  ((#f 12 0 233 43)
   (#f 0 1 1 17)
   (#f 0 18 18 16)
   ((#f 0 17 17 2))
   (#f 0 3 3 3))
  ((#f 1 -39 5 56)
   (#f 0 1 1 17)
   (#f 0 18 18 10)
   ((#f 0 11 11 21)
    ((#f 0 1 1 9) (#f 0 1 1 3) (#f 0 4 4 3))
    ((#f 0 5 5 9) (#f 0 1 1 3) (#f 0 4 4 3)))
   (#f 0 6 6 3))
  ((#f 4 -52 99 48)
   (#f 0 1 1 17)
   (#f 0 18 18 21)
   ((#f 0 22 22 2))
   (#f 0 3 3 3))
  ((#f 1 -44 5 62)
   (#f 0 1 1 17)
   (#f 0 18 18 24)
   ((#f 0 25 25 13) ((#f 0 1 1 11) (#f 0 1 1 5) (#f 0 6 6 3)))
   (#f 0 6 6 3))
  ((#f 1 -58 5 62)
   (#f 0 1 1 17)
   (#f 0 18 18 24)
   ((#f 0 25 25 13) ((#f 0 1 1 11) (#f 0 1 1 5) (#f 0 6 6 3)))
   (#f 0 6 6 3))
  ((#f 1 -58 5 73)
   (#f 0 1 1 17)
   (#f 0 18 18 21)
   ((#f 0 22 22 27)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 9) (#f 0 1 1 3) (#f 0 4 4 3)))
   (#f 0 6 6 3))
  ((#f 1 -69 5 86)
   (#f 0 1 1 17)
   (#f 0 18 18 21)
   ((#f 0 22 22 39)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 9) (#f 0 1 1 3) (#f 0 4 4 3))
    ((#f 0 5 5 11) (#f 0 1 1 5) (#f 0 6 6 3)))
   (#f 0 6 6 4))
  ((#f 2 -81 7 52)
   (#f 0 1 1 17)
   (#f 0 18 18 16)
   ((#f 0 17 17 11) ((#f 0 1 1 9) (#f 0 1 1 3) (#f 0 4 4 3)))
   (#f 0 6 6 3))
  ((#f 1 -48 5 60)
   (#f 0 1 1 17)
   (#f 0 18 18 11)
   ((#f 0 12 12 23)
    ((#f 0 1 1 9) (#f 0 1 1 3) (#f 0 4 4 3))
    ((#f 0 5 5 11) (#f 0 1 1 5) (#f 0 6 6 3)))
   (#f 0 6 6 4))
  ((#f 2 -55 7 38) (#f 0 1 1 17) (#f 0 18 18 10) ((#f 0 11 11 2)) (#f 0 3 3 4))
  ((#f 2 -33 7 16) (#f 0 1 1 3) (#f 0 4 4 8) (#f 0 9 9 1))
  ((#f 2 -14 4 95)
   (#f 0 1 1 5)
   (#f 0 6 6 7)
   ((#f 0 8 8 29)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 11) (#f 0 1 1 5) (#f 0 6 6 3)))
   (#f 0 6 6 4)
   ((#f 1 -43 7 42)
    (#f 0 1 1 21)
    (#f 0 22 22 1)
    (#f 0 2 2 1)
    (#f 0 2 2 8)
    (#f 0 9 9 5)))
  ((#f 3 -38 38 62)
   (#f 0 1 1 5)
   (#f 0 6 6 4)
   ((#f 0 5 5 25)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3)))
   (#f 0 6 6 3)
   ((#f 1 -36 6 17)
    (#f 0 1 1 3)
    ((#f 0 4 4 9) (#f 0 1 1 3) (#f 0 4 4 1) (#f 0 2 2 1))
    (#f 0 3 3 1)))
  ((#f 3 -17 30 855)
   (#f 0 1 1 5)
   (#f 0 6 6 13)
   ((#f 0 14 14 44)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 9) (#f 0 1 1 3) (#f 0 4 4 3))
    ((#f 0 5 5 16) (#f 0 1 1 10) (#f 0 11 11 3)))
   (#f 0 6 6 3)
   ((#f 2 -64 49 43)
    (#f 0 1 1 3)
    (#f 0 4 4 5)
    ((#f 0 6 6 31) (#f 0 1 1 21) (#f 0 22 22 1) (#f 0 2 2 1) (#f 0 2 2 3)))
   ((#f 1 -38 8 692)
    (#f 0 1 1 2)
    (#f 0 3 3 5)
    ((#f 0 6 6 663)
     (#f 0 1 1 5)
     ((#f 2 -9 124 197)
      (#f 0 1 1 3)
      (#f 0 4 4 12)
      ((#f 0 13 13 178)
       (#f 0 1 1 4)
       ((#f 0 5 5 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
       ((#f 1 -14 31 56)
        (#f 0 1 1 1)
        ((#f 0 2 2 46)
         (#f 0 1 1 21)
         ((#f 0 22 22 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
         (#f 0 3 3 1)
         (#f 0 2 2 3))
        (#f 0 5 5 5))
       ((#f 1 -50 35 41)
        (#f 0 1 1 3)
        ((#f 0 4 4 35)
         (#f 0 1 1 16)
         ((#f 0 17 17 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))))))
     ((#f 2 -61 40 306)
      (#f 0 1 1 2)
      (#f 0 3 3 12)
      ((#f 1 -2 19 141)
       (#f 0 1 1 5)
       ((#f 1 1 14 58)
        (#f 0 1 1 21)
        ((#f 0 22 22 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
        (#f 0 3 3 1)
        (#f 0 2 2 3)
        ((#f 0 4 4 11) (#f 0 1 1 1) (#f 0 2 2 1) (#f 0 2 2 5)))
       ((#f 1 -51 16 32)
        (#f 0 1 1 11)
        ((#f 0 12 12 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
        (#f 0 3 3 1))
       (#f 1 -30 11 10))
      ((#f 2 -2 25 129)
       (#f 0 1 1 5)
       ((#f 1 1 14 46)
        (#f 0 1 1 21)
        (#f 0 22 22 10)
        (#f 0 11 11 1)
        (#f 0 2 2 3)
        (#f 0 4 4 5))
       ((#f 1 -40 15 26) (#f 0 1 1 11) (#f 0 12 12 10) (#f 0 11 11 1))
       ((#f 1 -24 11 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1)))))
    (#f 3 -18 22 10)))
  ((#f 5 -4 78 673)
   (#f 0 1 1 5)
   (#f 0 6 6 10)
   ((#f 0 11 11 19)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 9) (#f 0 1 1 3) (#f 0 4 4 3)))
   (#f 0 6 6 4)
   ((#f 3 -36 64 18) (#f 0 1 1 3) (#f 0 4 4 10) (#f 0 11 11 1))
   ((#f 3 -16 51 52)
    (#f 0 1 1 4)
    (#f 0 5 5 10)
    ((#f 0 11 11 34)
     (#f 0 1 1 13)
     (#f 0 14 14 1)
     (#f 0 2 2 1)
     (#f 0 2 2 3)
     (#f 0 4 4 10)))
   ((#f 1 -40 15 52)
    (#f 0 1 1 4)
    (#f 0 5 5 10)
    ((#f 0 11 11 34)
     (#f 0 1 1 13)
     (#f 0 14 14 1)
     (#f 0 2 2 1)
     (#f 0 2 2 3)
     (#f 0 4 4 10)))
   ((#f 1 -40 15 52)
    (#f 0 1 1 4)
    (#f 0 5 5 10)
    ((#f 0 11 11 34)
     (#f 0 1 1 13)
     (#f 0 14 14 1)
     (#f 0 2 2 1)
     (#f 0 2 2 3)
     (#f 0 4 4 10)))
   ((#f 1 -40 15 52)
    (#f 0 1 1 4)
    (#f 0 5 5 10)
    ((#f 0 11 11 34)
     (#f 0 1 1 13)
     (#f 0 14 14 1)
     (#f 0 2 2 1)
     (#f 0 2 2 3)
     (#f 0 4 4 10)))
   ((#f 2 -40 16 68)
    (#f 0 1 1 2)
    ((#f 0 3 3 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
    ((#f 0 3 3 33)
     (#f 0 1 1 21)
     (#f 0 22 22 1)
     (#f 0 2 2 1)
     (#f 0 2 2 3)
     (#f 0 4 4 1))
    ((#f 0 3 3 12) (#f 0 1 1 10)))
   ((#f 1 -56 15 68)
    (#f 0 1 1 2)
    ((#f 0 3 3 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
    ((#f 0 3 3 33)
     (#f 0 1 1 21)
     (#f 0 22 22 1)
     (#f 0 2 2 1)
     (#f 0 2 2 3)
     (#f 0 4 4 1))
    ((#f 0 3 3 12) (#f 0 1 1 10)))
   ((#f 1 -56 15 68)
    (#f 0 1 1 2)
    ((#f 0 3 3 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
    ((#f 0 3 3 33)
     (#f 0 1 1 21)
     (#f 0 22 22 1)
     (#f 0 2 2 1)
     (#f 0 2 2 3)
     (#f 0 4 4 1))
    ((#f 0 3 3 12) (#f 0 1 1 10)))
   ((#f 1 -56 15 68)
    (#f 0 1 1 2)
    ((#f 0 3 3 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
    ((#f 0 3 3 33)
     (#f 0 1 1 21)
     (#f 0 22 22 1)
     (#f 0 2 2 1)
     (#f 0 2 2 3)
     (#f 0 4 4 1))
    ((#f 0 3 3 12) (#f 0 1 1 10))))
  ((#f 3 -58 16 736)
   (#f 0 1 1 5)
   (#f 0 6 6 18)
   ((#f 0 19 19 2))
   (#f 0 3 3 4)
   ((#f 2 -27 65 56)
    (#f 0 1 1 3)
    (#f 0 4 4 15)
    ((#f 0 16 16 34)
     (#f 0 1 1 2)
     ((#f 0 3 3 25)
      (#f 0 1 1 1)
      ((#f 0 2 2 18) (#f 0 1 1 10) (#f 0 11 11 1) (#f 0 2 2 3))
      (#f 0 5 5 2))
     (#f 0 4 4 1)
     (#f 0 2 2 1)))
   ((#f 3 -53 98 45)
    (#f 0 1 1 3)
    (#f 0 4 4 15)
    ((#f 0 16 16 23) (#f 0 1 1 21)))
   ((#f 2 -22 60 45)
    (#f 0 1 1 3)
    (#f 0 4 4 8)
    ((#f 0 9 9 30) (#f 0 1 1 10) (#f 0 11 11 1) (#f 0 2 2 15)))
   ((#f 2 -28 99 43)
    (#f 0 1 1 3)
    (#f 0 4 4 1)
    ((#f 0 2 2 35) (#f 0 1 1 24) (#f 0 25 25 8)))
   ((#f 1 -33 13 43)
    (#f 0 1 1 3)
    (#f 0 4 4 1)
    ((#f 0 2 2 35) (#f 0 1 1 24) (#f 0 25 25 8)))
   ((#f 2 -33 68 29) (#f 0 1 1 7) (#f 0 8 8 1) (#f 0 2 2 1) (#f 0 2 2 15)))
  ((#f 6 -15 124 1351)
   (#f 0 1 1 5)
   (#f 0 6 6 9)
   ((#f 0 10 10 11) ((#f 0 1 1 9) (#f 0 1 1 3) (#f 0 4 4 3)))
   (#f 0 6 6 4)
   ((#f 29 -27 1155 18) (#f 0 1 1 10) (#f 0 11 11 1) (#f 0 2 2 3))
   ((#f 1 -14 7 18) (#f 0 1 1 10) (#f 0 11 11 1) (#f 0 2 2 3))
   ((#f 1 -14 7 18) (#f 0 1 1 10) (#f 0 11 11 1) (#f 0 2 2 3))
   ((#f 1 -14 7 18) (#f 0 1 1 10) (#f 0 11 11 1) (#f 0 2 2 3)))))
