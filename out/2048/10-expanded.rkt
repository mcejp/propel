((begin
   (decl-external-fun get-player-input () int)
   (decl-external-fun random-int ((min int) (max int)) int)
   (decl-external-fun brd-count-empty-spots () int)
   (decl-external-fun brd-get-nth-empty-slot-x ((index int)) int)
   (decl-external-fun brd-get-nth-empty-slot-y ((index int)) int)
   (decl-external-fun brd-get-with-rotation ((x int) (y int) (dir int)) int)
   (decl-external-fun
    brd-set-with-rotation
    ((x int) (y int) (dir int) (stone int))
    Void)
   (def DIR-LEFT 0)
   (defun
    brd-set
    ((x int) (y int) (value int))
    Void
    (brd-set-with-rotation x y DIR-LEFT value))
   (defun and3 ((a int) (b int) (c int)) int (and (and a b) c))
   (defun
    update-row
    ((y int) (dir int))
    Void
    (def output-pos 0)
    (def was-merged 0)
    (begin
      (def x 0)
      (while
       (< x 4)
       (begin
         (def stone (brd-get-with-rotation x y dir))
         (begin
           (if stone
             (begin
               (def
                should-merge
                (and3
                 (> output-pos 0)
                 (= (brd-get-with-rotation (- output-pos 1) y dir) stone)
                 (not was-merged)))
               (if should-merge
                 (begin
                   (brd-set-with-rotation (- output-pos 1) y dir (* 2 stone))
                   (set! was-merged 1))
                 (begin
                   (brd-set-with-rotation output-pos y dir stone)
                   (set! was-merged 0)
                   (set! output-pos (+ output-pos 1)))))
             (Void)))
         (set! x (+ x 1)))))
    (begin
      (def columnn 0)
      (while
       (< columnn 4)
       (begin
         (begin
           (if (<= output-pos columnn)
             (begin (brd-set-with-rotation columnn y dir 0))
             (Void)))
         (set! columnn (+ columnn 1))))))
   (defun
    generate-new-stone
    ()
    Void
    (def new-stone-value (if (< (random-int 0 100) 90) 2 4))
    (def num-empty-spots (brd-count-empty-spots))
    (def nth-spot (random-int 0 num-empty-spots))
    (def x (brd-get-nth-empty-slot-x nth-spot))
    (def y (brd-get-nth-empty-slot-y nth-spot))
    (brd-set x y new-stone-value))
   (defun
    make-turn
    ((dir int))
    Void
    (begin
      (def row 0)
      (while (< row 4) (begin (update-row row dir) (set! row (+ row 1)))))))
 #f
 ((#<path:tests/2048.rkt> 0 0 0 4075)
  (#f 0 0 0 4075)
  ((#f 12 0 233 43)
   (#f 0 1 1 17)
   (#f 0 18 18 16)
   ((#f 0 17 17 2))
   (#f 0 3 3 3))
  ((#f 1 -39 5 56)
   (#f 0 1 1 17)
   (#f 0 18 18 10)
   ((#f 0 11 11 21)
    ((#f 0 1 1 9) (#f 0 1 1 3) (#f 0 4 4 3))
    ((#f 0 5 5 9) (#f 0 1 1 3) (#f 0 4 4 3)))
   (#f 0 6 6 3))
  ((#f 4 -52 99 48)
   (#f 0 1 1 17)
   (#f 0 18 18 21)
   ((#f 0 22 22 2))
   (#f 0 3 3 3))
  ((#f 1 -44 5 62)
   (#f 0 1 1 17)
   (#f 0 18 18 24)
   ((#f 0 25 25 13) ((#f 0 1 1 11) (#f 0 1 1 5) (#f 0 6 6 3)))
   (#f 0 6 6 3))
  ((#f 1 -58 5 62)
   (#f 0 1 1 17)
   (#f 0 18 18 24)
   ((#f 0 25 25 13) ((#f 0 1 1 11) (#f 0 1 1 5) (#f 0 6 6 3)))
   (#f 0 6 6 3))
  ((#f 1 -58 5 73)
   (#f 0 1 1 17)
   (#f 0 18 18 21)
   ((#f 0 22 22 27)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 9) (#f 0 1 1 3) (#f 0 4 4 3)))
   (#f 0 6 6 3))
  ((#f 1 -69 5 86)
   (#f 0 1 1 17)
   (#f 0 18 18 21)
   ((#f 0 22 22 39)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 9) (#f 0 1 1 3) (#f 0 4 4 3))
    ((#f 0 5 5 11) (#f 0 1 1 5) (#f 0 6 6 3)))
   (#f 0 6 6 4))
  ((#f 2 -81 7 16) (#f 0 1 1 3) (#f 0 4 4 8) (#f 0 9 9 1))
  ((#f 2 -14 4 95)
   (#f 0 1 1 5)
   (#f 0 6 6 7)
   ((#f 0 8 8 29)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 11) (#f 0 1 1 5) (#f 0 6 6 3)))
   (#f 0 6 6 4)
   ((#f 1 -43 7 42)
    (#f 0 1 1 21)
    (#f 0 22 22 1)
    (#f 0 2 2 1)
    (#f 0 2 2 8)
    (#f 0 9 9 5)))
  ((#f 3 -38 38 62)
   (#f 0 1 1 5)
   (#f 0 6 6 4)
   ((#f 0 5 5 25)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3)))
   (#f 0 6 6 3)
   ((#f 1 -36 6 17)
    (#f 0 1 1 3)
    ((#f 0 4 4 9) (#f 0 1 1 3) (#f 0 4 4 1) (#f 0 2 2 1))
    (#f 0 3 3 1)))
  ((#f 3 -17 65 1029)
   (#f 0 1 1 5)
   (#f 0 6 6 10)
   ((#f 0 11 11 19)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 9) (#f 0 1 1 3) (#f 0 4 4 3)))
   (#f 0 6 6 4)
   ((#f 3 -36 64 18) (#f 0 1 1 3) (#f 0 4 4 10) (#f 0 11 11 1))
   ((#f 1 -16 5 18) (#f 0 1 1 3) (#f 0 4 4 10) (#f 0 11 11 1))
   ((#f 2 -16 6 776)
    (#f 0 0 0 776)
    ((#f 0 0 0 776) (#f 0 0 0 776) (#f 0 11 11 1) (#f 0 -11 -11 776))
    ((#f 0 0 0 776)
     (#f 0 0 0 776)
     ((#f 0 0 0 776) (#f 0 0 0 776) (#f 0 11 11 1) (#f 0 2 2 1))
     ((#f 0 -13 -13 776)
      (#f 0 0 0 776)
      ((#f 2 2 64 43)
       (#f 0 1 1 3)
       (#f 0 4 4 5)
       ((#f 0 6 6 31) (#f 0 1 1 21) (#f 0 22 22 1) (#f 0 2 2 1) (#f 0 2 2 3)))
      ((#<path:propel-builtins.rkt> 6 -35 88 72)
       (#f 0 1 1 5)
       ((#f 1 1 15 55)
        (#f 0 1 1 2)
        (#<path:tests/2048.rkt> -6 0 -89 5)
        ((#<path:propel-builtins.rkt> 7 1 108 16)
         (#f 0 1 1 5)
         ((#<path:tests/2048.rkt> -5 -6 19 176)
          (#f 0 1 1 3)
          (#f 0 4 4 12)
          ((#f 0 13 13 157)
           (#f 0 1 1 4)
           ((#f 0 5 5 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
           ((#f 1 -14 33 56)
            (#f 0 1 1 1)
            ((#f 0 2 2 46)
             (#f 0 1 1 21)
             ((#f 0 22 22 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
             (#f 0 3 3 1)
             (#f 0 2 2 3))
            (#f 0 5 5 5))
           ((#f 1 -50 37 16) (#f 0 1 1 3) (#f 0 4 4 10))))
         ((#f 2 -29 51 307)
          (#f 0 1 1 2)
          (#f 0 3 3 12)
          ((#f 1 -2 21 115)
           (#f 0 1 1 5)
           ((#f 1 1 16 58)
            (#f 0 1 1 21)
            ((#f 0 22 22 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
            (#f 0 3 3 1)
            (#f 0 2 2 3)
            ((#f 0 4 4 11) (#f 0 1 1 1) (#f 0 2 2 1) (#f 0 2 2 5)))
           ((#f 1 -51 18 19) (#f 0 1 1 4) (#f 0 5 5 10) (#f 0 11 11 1)))
          ((#f 2 -19 21 148)
           (#f 0 1 1 5)
           ((#f 1 1 16 46)
            (#f 0 1 1 21)
            (#f 0 22 22 10)
            (#f 0 11 11 1)
            (#f 0 2 2 3)
            (#f 0 4 4 5))
           ((#f 1 -40 17 19) (#f 0 1 1 4) (#f 0 5 5 10) (#f 0 11 11 1))
           ((#f 1 -17 13 34)
            (#f 0 1 1 4)
            (#f 0 5 5 10)
            ((#f 0 11 11 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))))))
        ((#<path:propel-builtins.rkt> -6 -30 -490 6) (#f 0 1 1 4))))
      ((#<path:tests/2048.rkt> -11 -10 -255 776)
       (#f 0 0 0 776)
       (#f 0 11 11 1)
       ((#f 0 -11 -11 776)
        (#f 0 0 0 776)
        (#f 0 11 11 1)
        (#f 0 -11 -11 776))))))
   ((#f 22 0 780 102)
    (#f 0 0 0 102)
    ((#f 0 0 0 102) (#f 0 0 0 102) (#f 0 11 11 7) (#f 0 -11 -11 102))
    ((#f 0 0 0 102)
     (#f 0 0 0 102)
     ((#f 0 0 0 102) (#f 0 0 0 102) (#f 0 11 11 7) (#f 0 8 8 1))
     ((#f 0 -19 -19 102)
      (#f 0 0 0 102)
      ((#<path:propel-builtins.rkt> -14 5 -590 72)
       (#f 0 1 1 5)
       ((#f 1 1 15 55)
        (#f 0 1 1 2)
        ((#<path:tests/2048.rkt> 14 0 604 23)
         (#f 0 1 1 2)
         (#f 0 3 3 10)
         (#f 0 11 11 7))
        ((#<path:propel-builtins.rkt> -13 -14 -600 16)
         (#f 0 1 1 5)
         ((#<path:tests/2048.rkt> 14 -6 614 39)
          (#f 0 1 1 21)
          (#f 0 22 22 7)
          (#f 0 8 8 1)
          (#f 0 2 2 3)
          (#f 0 4 4 1)))
        ((#<path:propel-builtins.rkt> -13 -32 -624 6) (#f 0 1 1 4))))
      ((#<path:tests/2048.rkt> 11 -10 525 102)
       (#f 0 0 0 102)
       (#f 0 11 11 7)
       ((#f 0 -11 -11 102)
        (#f 0 0 0 102)
        (#f 0 11 11 7)
        (#f 0 -11 -11 102)))))))
  ((#f 5 -2 106 736)
   (#f 0 1 1 5)
   (#f 0 6 6 18)
   ((#f 0 19 19 2))
   (#f 0 3 3 4)
   ((#f 2 -27 65 56)
    (#f 0 1 1 3)
    (#f 0 4 4 15)
    ((#f 0 16 16 34)
     (#f 0 1 1 2)
     ((#f 0 3 3 25)
      (#f 0 1 1 1)
      ((#f 0 2 2 18) (#f 0 1 1 10) (#f 0 11 11 1) (#f 0 2 2 3))
      (#f 0 5 5 2))
     (#f 0 4 4 1)
     (#f 0 2 2 1)))
   ((#f 3 -53 98 45)
    (#f 0 1 1 3)
    (#f 0 4 4 15)
    ((#f 0 16 16 23) (#f 0 1 1 21)))
   ((#f 2 -22 60 45)
    (#f 0 1 1 3)
    (#f 0 4 4 8)
    ((#f 0 9 9 30) (#f 0 1 1 10) (#f 0 11 11 1) (#f 0 2 2 15)))
   ((#f 2 -28 99 43)
    (#f 0 1 1 3)
    (#f 0 4 4 1)
    ((#f 0 2 2 35) (#f 0 1 1 24) (#f 0 25 25 8)))
   ((#f 1 -33 13 43)
    (#f 0 1 1 3)
    (#f 0 4 4 1)
    ((#f 0 2 2 35) (#f 0 1 1 24) (#f 0 25 25 8)))
   ((#f 2 -33 68 29) (#f 0 1 1 7) (#f 0 8 8 1) (#f 0 2 2 1) (#f 0 2 2 15)))
  ((#f 6 -15 124 1272)
   (#f 0 1 1 5)
   (#f 0 6 6 9)
   ((#f 0 10 10 11) ((#f 0 1 1 9) (#f 0 1 1 3) (#f 0 4 4 3)))
   (#f 0 6 6 4)
   ((#f 29 -27 1115 42)
    (#f 0 0 0 42)
    ((#f 0 0 0 42) (#f 0 0 0 42) (#f 0 11 11 3) (#f 0 -11 -11 42))
    ((#f 0 0 0 42)
     (#f 0 0 0 42)
     ((#f 0 0 0 42) (#f 0 0 0 42) (#f 0 11 11 3) (#f 0 4 4 1))
     ((#f 0 -15 -15 42)
      (#f 0 0 0 42)
      ((#f 1 2 21 20) (#f 0 1 1 10) (#f 0 11 11 3) (#f 0 4 4 3))
      ((#f -1 -18 -37 42)
       (#f 0 0 0 42)
       (#f 0 11 11 3)
       ((#f 0 -11 -11 42)
        (#f 0 0 0 42)
        (#f 0 11 11 3)
        (#f 0 -11 -11 42)))))))))
