((#%begin
  (#%define get-player-input (#%external-function get-player-input () int))
  (#%define
   random-int
   (#%external-function random-int ((min int) (max int)) int))
  (#%define
   brd-count-empty-spots
   (#%external-function brd-count-empty-spots () int))
  (#%define
   brd-get-nth-empty-slot-x
   (#%external-function brd-get-nth-empty-slot-x ((index int)) int))
  (#%define
   brd-get-nth-empty-slot-y
   (#%external-function brd-get-nth-empty-slot-y ((index int)) int))
  (#%define
   brd-get-with-rotation
   (#%external-function brd-get-with-rotation ((x int) (y int) (dir int)) int))
  (#%define
   brd-set-with-rotation
   (#%external-function
    brd-set-with-rotation
    ((x int) (y int) (dir int) (stone int))
    Void))
  (#%define
   is-marked-merged
   (#%external-function is-marked-merged ((pos int)) int))
  (#%define
   mark-merged
   (#%external-function mark-merged ((pos int) (value int)) Void))
  (#%define dummy-void (#%external-function dummy-void () Void))
  (#%define DIR-LEFT 0)
  (#%defun
   brd-set
   ((x int) (y int) (value int))
   Void
   (#%begin (#%app brd-set-with-rotation x y DIR-LEFT value)))
  (#%defun
   and3
   ((a int) (b int) (c int))
   int
   (#%begin (#%app and (#%app and a b) c)))
  (#%defun
   update-column
   ((x int) (y int) (dir int) (output-pos int))
   int
   (#%begin
    (#%define stone (#%app brd-get-with-rotation x y dir))
    (#%if
     stone
     (#%begin
      (#%define
       should-merge
       (#%app
        and3
        (#%app > output-pos 0)
        (#%app
         =
         (#%app brd-get-with-rotation (#%app - output-pos 1) y dir)
         stone)
        (#%app not (#%app is-marked-merged (#%app - output-pos 1)))))
      (#%if
       should-merge
       (#%begin
        (#%app
         brd-set-with-rotation
         (#%app - output-pos 1)
         y
         dir
         (#%app * 2 stone))
        (#%app mark-merged (#%app - output-pos 1) 1)
        output-pos)
       (#%begin
        (#%app brd-set-with-rotation output-pos y dir stone)
        (#%app mark-merged output-pos 0)
        (#%app + output-pos 1))))
     output-pos)))
  (#%defun
   update-row
   ((y int) (dir int))
   Void
   (#%begin
    (#%define output-pos 0)
    (#%set-var output-pos (#%app update-column 0 y dir output-pos))
    (#%set-var output-pos (#%app update-column 1 y dir output-pos))
    (#%set-var output-pos (#%app update-column 2 y dir output-pos))
    (#%set-var output-pos (#%app update-column 3 y dir output-pos))
    (#%if
     (#%app < output-pos 1)
     (#%app brd-set-with-rotation 0 y dir 0)
     (#%app dummy-void))
    (#%if
     (#%app < output-pos 2)
     (#%app brd-set-with-rotation 1 y dir 0)
     (#%app dummy-void))
    (#%if
     (#%app < output-pos 3)
     (#%app brd-set-with-rotation 2 y dir 0)
     (#%app dummy-void))
    (#%if
     (#%app < output-pos 4)
     (#%app brd-set-with-rotation 3 y dir 0)
     (#%app dummy-void))))
  (#%defun
   generate-new-stone
   ()
   Void
   (#%begin
    (#%define new-stone-value (#%if (#%app < (#%app random-int 0 100) 90) 2 4))
    (#%define num-empty-spots (#%app brd-count-empty-spots))
    (#%define nth-spot (#%app random-int 0 num-empty-spots))
    (#%define x (#%app brd-get-nth-empty-slot-x nth-spot))
    (#%define y (#%app brd-get-nth-empty-slot-y nth-spot))
    (#%app brd-set x y new-stone-value)))
  (#%defun
   make-turn
   ((dir int))
   Void
   (#%begin
    (#%app update-row 0 dir)
    (#%app update-row 1 dir)
    (#%app update-row 2 dir)
    (#%app update-row 3 dir))))
 #f
 ((#<path:#INT#/propel-syntax.rkt> 49 95 1819 2)
  (#f 0 0 0 2)
  ((#<path:tests/2048.rkt> -37 -95 -1586 43)
   (#f 0 0 0 43)
   (#f 0 19 19 16)
   ((#f 0 -19 -19 43)
    (#f 0 0 0 43)
    (#f 0 19 19 16)
    ((#f 0 17 17 2))
    (#f 0 3 3 3)))
  ((#f 1 -39 5 56)
   (#f 0 0 0 56)
   (#f 0 19 19 10)
   ((#f 0 -19 -19 56)
    (#f 0 0 0 56)
    (#f 0 19 19 10)
    ((#f 0 11 11 21)
     ((#f 0 1 1 9) (#f 0 1 1 3) (#f 0 4 4 3))
     ((#f 0 5 5 9) (#f 0 1 1 3) (#f 0 4 4 3)))
    (#f 0 6 6 3)))
  ((#f 4 -52 99 48)
   (#f 0 0 0 48)
   (#f 0 19 19 21)
   ((#f 0 -19 -19 48)
    (#f 0 0 0 48)
    (#f 0 19 19 21)
    ((#f 0 22 22 2))
    (#f 0 3 3 3)))
  ((#f 1 -44 5 62)
   (#f 0 0 0 62)
   (#f 0 19 19 24)
   ((#f 0 -19 -19 62)
    (#f 0 0 0 62)
    (#f 0 19 19 24)
    ((#f 0 25 25 13) ((#f 0 1 1 11) (#f 0 1 1 5) (#f 0 6 6 3)))
    (#f 0 6 6 3)))
  ((#f 1 -58 5 62)
   (#f 0 0 0 62)
   (#f 0 19 19 24)
   ((#f 0 -19 -19 62)
    (#f 0 0 0 62)
    (#f 0 19 19 24)
    ((#f 0 25 25 13) ((#f 0 1 1 11) (#f 0 1 1 5) (#f 0 6 6 3)))
    (#f 0 6 6 3)))
  ((#f 1 -58 5 73)
   (#f 0 0 0 73)
   (#f 0 19 19 21)
   ((#f 0 -19 -19 73)
    (#f 0 0 0 73)
    (#f 0 19 19 21)
    ((#f 0 22 22 27)
     ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
     ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3))
     ((#f 0 5 5 9) (#f 0 1 1 3) (#f 0 4 4 3)))
    (#f 0 6 6 3)))
  ((#f 1 -69 5 86)
   (#f 0 0 0 86)
   (#f 0 19 19 21)
   ((#f 0 -19 -19 86)
    (#f 0 0 0 86)
    (#f 0 19 19 21)
    ((#f 0 22 22 39)
     ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
     ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3))
     ((#f 0 5 5 9) (#f 0 1 1 3) (#f 0 4 4 3))
     ((#f 0 5 5 11) (#f 0 1 1 5) (#f 0 6 6 3)))
    (#f 0 6 6 4)))
  ((#f 2 -81 7 52)
   (#f 0 0 0 52)
   (#f 0 19 19 16)
   ((#f 0 -19 -19 52)
    (#f 0 0 0 52)
    (#f 0 19 19 16)
    ((#f 0 17 17 11) ((#f 0 1 1 9) (#f 0 1 1 3) (#f 0 4 4 3)))
    (#f 0 6 6 3)))
  ((#f 1 -48 5 60)
   (#f 0 0 0 60)
   (#f 0 19 19 11)
   ((#f 0 -19 -19 60)
    (#f 0 0 0 60)
    (#f 0 19 19 11)
    ((#f 0 12 12 23)
     ((#f 0 1 1 9) (#f 0 1 1 3) (#f 0 4 4 3))
     ((#f 0 5 5 11) (#f 0 1 1 5) (#f 0 6 6 3)))
    (#f 0 6 6 4)))
  ((#f 2 -55 7 38)
   (#f 0 0 0 38)
   (#f 0 19 19 10)
   ((#f 0 -19 -19 38)
    (#f 0 0 0 38)
    (#f 0 19 19 10)
    ((#f 0 11 11 2))
    (#f 0 3 3 4)))
  ((#f 2 -33 7 16) (#f 0 0 0 16) (#f 0 5 5 8) (#f 0 9 9 1))
  ((#f 2 -14 4 95)
   (#f 0 0 0 95)
   (#f 0 7 7 7)
   ((#f 0 8 8 29)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 11) (#f 0 1 1 5) (#f 0 6 6 3)))
   (#f 0 6 6 4)
   ((#f 0 -45 -45 95)
    (#f 0 0 0 95)
    ((#f 1 2 52 42)
     (#f 0 0 0 42)
     (#f 0 1 1 21)
     (#f 0 22 22 1)
     (#f 0 2 2 1)
     (#f 0 2 2 8)
     (#f 0 9 9 5))))
  ((#f 3 -38 38 62)
   (#f 0 0 0 62)
   (#f 0 7 7 4)
   ((#f 0 5 5 25)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3)))
   (#f 0 6 6 3)
   ((#f 0 -38 -38 62)
    (#f 0 0 0 62)
    ((#f 1 2 44 17)
     (#f 0 0 0 17)
     (#f 0 1 1 3)
     ((#f 0 4 4 9) (#f 0 0 0 9) (#f 0 1 1 3) (#f 0 4 4 1) (#f 0 2 2 1))
     (#f 0 3 3 1))))
  ((#f 3 -17 30 855)
   (#f 0 0 0 855)
   (#f 0 7 7 13)
   ((#f 0 14 14 44)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 9) (#f 0 1 1 3) (#f 0 4 4 3))
    ((#f 0 5 5 16) (#f 0 1 1 10) (#f 0 11 11 3)))
   (#f 0 6 6 3)
   ((#f 0 -66 -66 855)
    (#f 0 0 0 855)
    ((#f 2 2 115 43)
     (#f 0 0 0 43)
     (#f 0 5 5 5)
     ((#f 0 6 6 31)
      (#f 0 0 0 31)
      (#f 0 1 1 21)
      (#f 0 22 22 1)
      (#f 0 2 2 1)
      (#f 0 2 2 3)))
    ((#f 1 -38 8 692)
     (#f 0 0 0 692)
     (#f 0 4 4 5)
     ((#f 0 6 6 663)
      (#f 0 0 0 663)
      ((#f 2 -8 125 197)
       (#f 0 0 0 197)
       (#f 0 5 5 12)
       ((#f 0 13 13 178)
        (#f 0 0 0 178)
        (#f 0 1 1 4)
        ((#f 0 5 5 16) (#f 0 0 0 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
        ((#f 1 -14 31 56)
         (#f 0 0 0 56)
         (#f 0 1 1 1)
         ((#f 0 2 2 46)
          (#f 0 0 0 46)
          (#f 0 1 1 21)
          ((#f 0 22 22 16)
           (#f 0 0 0 16)
           (#f 0 1 1 1)
           (#f 0 2 2 10)
           (#f 0 11 11 1))
          (#f 0 3 3 1)
          (#f 0 2 2 3))
         (#f 0 5 5 5))
        ((#f 1 -50 35 41)
         (#f 0 0 0 41)
         (#f 0 1 1 3)
         ((#f 0 4 4 35)
          (#f 0 0 0 35)
          (#f 0 1 1 16)
          ((#f 0 17 17 16)
           (#f 0 0 0 16)
           (#f 0 1 1 1)
           (#f 0 2 2 10)
           (#f 0 11 11 1))))))
      ((#f 2 -61 40 306)
       (#f 0 0 0 306)
       (#f 0 4 4 12)
       ((#f 1 -2 19 141)
        (#f 0 0 0 141)
        ((#f 1 2 15 58)
         (#f 0 0 0 58)
         (#f 0 1 1 21)
         ((#f 0 22 22 16)
          (#f 0 0 0 16)
          (#f 0 1 1 1)
          (#f 0 2 2 10)
          (#f 0 11 11 1))
         (#f 0 3 3 1)
         (#f 0 2 2 3)
         ((#f 0 4 4 11) (#f 0 0 0 11) (#f 0 1 1 1) (#f 0 2 2 1) (#f 0 2 2 5)))
        ((#f 1 -51 16 32)
         (#f 0 0 0 32)
         (#f 0 1 1 11)
         ((#f 0 12 12 16)
          (#f 0 0 0 16)
          (#f 0 1 1 1)
          (#f 0 2 2 10)
          (#f 0 11 11 1))
         (#f 0 3 3 1))
        (#f 1 -30 11 10))
       ((#f 2 -2 25 129)
        (#f 0 0 0 129)
        ((#f 1 2 15 46)
         (#f 0 0 0 46)
         (#f 0 1 1 21)
         (#f 0 22 22 10)
         (#f 0 11 11 1)
         (#f 0 2 2 3)
         (#f 0 4 4 5))
        ((#f 1 -40 15 26)
         (#f 0 0 0 26)
         (#f 0 1 1 11)
         (#f 0 12 12 10)
         (#f 0 11 11 1))
        ((#f 1 -24 11 16)
         (#f 0 0 0 16)
         (#f 0 1 1 1)
         (#f 0 2 2 10)
         (#f 0 11 11 1)))))
     (#f 3 -18 22 10))))
  ((#f 5 -4 78 673)
   (#f 0 0 0 673)
   (#f 0 7 7 10)
   ((#f 0 11 11 19)
    ((#f 0 1 1 7) (#f 0 1 1 1) (#f 0 2 2 3))
    ((#f 0 5 5 9) (#f 0 1 1 3) (#f 0 4 4 3)))
   (#f 0 6 6 4)
   ((#f 0 -38 -38 673)
    (#f 0 0 0 673)
    ((#f 3 2 102 18) (#f 0 0 0 18) (#f 0 5 5 10) (#f 0 11 11 1))
    ((#f 3 -16 51 52)
     (#f 0 0 0 52)
     (#f 0 6 6 10)
     ((#f 0 11 11 34)
      (#f 0 0 0 34)
      (#f 0 1 1 13)
      (#f 0 14 14 1)
      (#f 0 2 2 1)
      (#f 0 2 2 3)
      (#f 0 4 4 10)))
    ((#f 1 -40 15 52)
     (#f 0 0 0 52)
     (#f 0 6 6 10)
     ((#f 0 11 11 34)
      (#f 0 0 0 34)
      (#f 0 1 1 13)
      (#f 0 14 14 1)
      (#f 0 2 2 1)
      (#f 0 2 2 3)
      (#f 0 4 4 10)))
    ((#f 1 -40 15 52)
     (#f 0 0 0 52)
     (#f 0 6 6 10)
     ((#f 0 11 11 34)
      (#f 0 0 0 34)
      (#f 0 1 1 13)
      (#f 0 14 14 1)
      (#f 0 2 2 1)
      (#f 0 2 2 3)
      (#f 0 4 4 10)))
    ((#f 1 -40 15 52)
     (#f 0 0 0 52)
     (#f 0 6 6 10)
     ((#f 0 11 11 34)
      (#f 0 0 0 34)
      (#f 0 1 1 13)
      (#f 0 14 14 1)
      (#f 0 2 2 1)
      (#f 0 2 2 3)
      (#f 0 4 4 10)))
    ((#f 2 -40 16 68)
     (#f 0 0 0 68)
     ((#f 0 4 4 16) (#f 0 0 0 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
     ((#f 0 3 3 33)
      (#f 0 0 0 33)
      (#f 0 1 1 21)
      (#f 0 22 22 1)
      (#f 0 2 2 1)
      (#f 0 2 2 3)
      (#f 0 4 4 1))
     ((#f 0 3 3 12) (#f 0 0 0 12) (#f 0 1 1 10)))
    ((#f 1 -56 15 68)
     (#f 0 0 0 68)
     ((#f 0 4 4 16) (#f 0 0 0 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
     ((#f 0 3 3 33)
      (#f 0 0 0 33)
      (#f 0 1 1 21)
      (#f 0 22 22 1)
      (#f 0 2 2 1)
      (#f 0 2 2 3)
      (#f 0 4 4 1))
     ((#f 0 3 3 12) (#f 0 0 0 12) (#f 0 1 1 10)))
    ((#f 1 -56 15 68)
     (#f 0 0 0 68)
     ((#f 0 4 4 16) (#f 0 0 0 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
     ((#f 0 3 3 33)
      (#f 0 0 0 33)
      (#f 0 1 1 21)
      (#f 0 22 22 1)
      (#f 0 2 2 1)
      (#f 0 2 2 3)
      (#f 0 4 4 1))
     ((#f 0 3 3 12) (#f 0 0 0 12) (#f 0 1 1 10)))
    ((#f 1 -56 15 68)
     (#f 0 0 0 68)
     ((#f 0 4 4 16) (#f 0 0 0 16) (#f 0 1 1 1) (#f 0 2 2 10) (#f 0 11 11 1))
     ((#f 0 3 3 33)
      (#f 0 0 0 33)
      (#f 0 1 1 21)
      (#f 0 22 22 1)
      (#f 0 2 2 1)
      (#f 0 2 2 3)
      (#f 0 4 4 1))
     ((#f 0 3 3 12) (#f 0 0 0 12) (#f 0 1 1 10)))))
  ((#f 3 -58 16 736)
   (#f 0 0 0 736)
   (#f 0 7 7 18)
   ((#f 0 19 19 2))
   (#f 0 3 3 4)
   ((#f 0 -29 -29 736)
    (#f 0 0 0 736)
    ((#f 2 2 94 56)
     (#f 0 0 0 56)
     (#f 0 5 5 15)
     ((#f 0 16 16 34)
      (#f 0 0 0 34)
      ((#f 0 4 4 25)
       (#f 0 0 0 25)
       (#f 0 1 1 1)
       ((#f 0 2 2 18) (#f 0 0 0 18) (#f 0 1 1 10) (#f 0 11 11 1) (#f 0 2 2 3))
       (#f 0 5 5 2))
      (#f 0 4 4 1)
      (#f 0 2 2 1)))
    ((#f 3 -53 98 45)
     (#f 0 0 0 45)
     (#f 0 5 5 15)
     ((#f 0 16 16 23) (#f 0 0 0 23) (#f 0 1 1 21)))
    ((#f 2 -22 60 45)
     (#f 0 0 0 45)
     (#f 0 5 5 8)
     ((#f 0 9 9 30) (#f 0 0 0 30) (#f 0 1 1 10) (#f 0 11 11 1) (#f 0 2 2 15)))
    ((#f 2 -28 99 43)
     (#f 0 0 0 43)
     (#f 0 5 5 1)
     ((#f 0 2 2 35) (#f 0 0 0 35) (#f 0 1 1 24) (#f 0 25 25 8)))
    ((#f 1 -33 13 43)
     (#f 0 0 0 43)
     (#f 0 5 5 1)
     ((#f 0 2 2 35) (#f 0 0 0 35) (#f 0 1 1 24) (#f 0 25 25 8)))
    ((#f 2 -33 68 29)
     (#f 0 0 0 29)
     (#f 0 1 1 7)
     (#f 0 8 8 1)
     (#f 0 2 2 1)
     (#f 0 2 2 15))))
  ((#f 6 -15 124 1351)
   (#f 0 0 0 1351)
   (#f 0 7 7 9)
   ((#f 0 10 10 11) ((#f 0 1 1 9) (#f 0 1 1 3) (#f 0 4 4 3)))
   (#f 0 6 6 4)
   ((#f 0 -29 -29 1351)
    (#f 0 0 0 1351)
    ((#f 29 2 1184 18) (#f 0 0 0 18) (#f 0 1 1 10) (#f 0 11 11 1) (#f 0 2 2 3))
    ((#f 1 -14 7 18) (#f 0 0 0 18) (#f 0 1 1 10) (#f 0 11 11 1) (#f 0 2 2 3))
    ((#f 1 -14 7 18) (#f 0 0 0 18) (#f 0 1 1 10) (#f 0 11 11 1) (#f 0 2 2 3))
    ((#f 1 -14 7 18)
     (#f 0 0 0 18)
     (#f 0 1 1 10)
     (#f 0 11 11 1)
     (#f 0 2 2 3))))))
